<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Munching Moo</title>
    <style>
      body {
        margin: 0;
        font-family: "Comic Sans MS", sans-serif;
        background: #e0ffe0;
        color: white;
        overflow-x: hidden;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      /* Background video styling */
      #bgVideo {
        position: fixed;
        top: 50%;
        left: 50%;
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        transform: translate(-50%, -50%);
        object-fit: cover;
        z-index: -1;
        pointer-events: none;
        filter: brightness(0.6);
      }
      header {
        background-color: rgb(105, 170, 90);
        text-align: center;
        padding: 2rem 1rem;
        z-index: 1;
      }
      header h1 {
        font-size: 3rem;
        margin: 0;
      }
      .moo-description {
        max-width: 600px;
        margin: 2rem auto;
        text-align: center;
        font-size: 1.5rem;
        z-index: 1;
      }
      .cow {
        display: block;
        margin: 2rem auto;
        width: 200px;
        transition: transform 0.2s ease-in-out;
        cursor: pointer;
        z-index: 1;
      }
      .cow:hover {
        transform: scale(1.1) rotate(-5deg);
      }

      .bubble {
        font-size: 2rem;
        text-align: center;
        margin-top: 2rem;
        z-index: 1;
      }
      .cow.walking {
        animation: walkAcross 12s linear infinite;
        position: absolute;
        bottom: 100px;
      }

      .cow.chewing {
        animation: chew 0.4s ease-in-out infinite;
      }

      footer {
        text-align: center;
        padding: 1rem 0;
        font-size: 1rem;
        color: white;
        background-color: rgba(0, 0, 0, 0.3);
        margin-top: auto;
        z-index: 1;
      }

      /* Mobile-specific styles */
      @media (max-width: 768px) {
        header h1 {
          font-size: 2rem;
        }
        .moo-description {
          font-size: 1.2rem;
          padding: 0 1rem;
        }
        .bubble {
          font-size: 1.5rem;
        }
      }

      /* Speech not supported message */
      .no-speech-warning {
        display: none;
        background: rgba(0, 0, 0, 0.7);
        padding: 10px;
        border-radius: 10px;
        max-width: 80%;
        margin: 1rem auto;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- ðŸŽ¥ Background Video -->
    <video autoplay muted loop playsinline id="bgVideo">
      <source src="cow.mp4" type="video/mp4" />
      Your browser does not support the video tag.
    </video>

    <header>
      <h1>
        Munching Mooooo..
        <img src="cow-svgrepo-com.svg" alt="cow face" height="80" />
        of Edmonton
      </h1>
    </header>

    <div class="moo-description">
      <p>
        Meet <strong>Moooo</strong> â€“ the cow that never stops munching! She
        loves grass, hay, and talking about herself in moos. Seriously, she just
        won't stop moooooing. <br /><strong
          >Click on her to make her moooo...</strong
        >
      </p>
    </div>

    <img
      src="cow-face-svgrepo-com.svg"
      alt="Moooo the Cow"
      class="cow"
      id="mooCow"
    />

    <div class="bubble" id="mooBubble">Moooooooooo! ðŸ˜‹</div>
    <div class="no-speech-warning" id="noSpeechWarning">
      Your device doesn't support voice synthesis, but Moooo still wants to
      chat!
    </div>

    <audio id="realMoo">
      <source src="cow_sound.mp3" type="audio/mpeg" />
    </audio>

    <footer>
      DON'T EVER TALK ABOUT MY STONES EVER AGAIN! THEY ARE PRECIOUS.
      <br />Created by STOOONY
    </footer>

    <script>
      const cow = document.getElementById("mooCow");
      const bubble = document.getElementById("mooBubble");
      const realMoo = document.getElementById("realMoo");
      const noSpeechWarning = document.getElementById("noSpeechWarning");

      // Check if speech synthesis is supported
      const isSpeechSupported = "speechSynthesis" in window;
      if (!isSpeechSupported) {
        noSpeechWarning.style.display = "block";
      }

      const mooPhrases = [
        "Moooooo... I cut my own grass in my backyard!",
        "Mooooooo... that grass was delicious!",
        "Moooo... I could chew all day long!",
        "Moooooo... so peaceful under the sun...",
        "Mooooo... I dream of endless fields of grass!",
        "Moooo... hay, hay, hay! My favorite!",
        "Mooooooo... I'm so happy today!",
        "Moooo... don't touch my hay!",
        "Moooo... Munch munch time again!",
        "Mooooo... I just love to talk and chew!",
        "Mooooooo.. I am more talkative than Stony",
        "Moooooo... have you heard the latest moo gossip?",
        "Moooo... I'm always moo-ving and grooving!",
        "Mooooooo... can't stop chatting about my day!",
        "Moooo... I've got so much to say, moo-ve over!",
        "Mooooo... sometimes I just sing my moos aloud!",
        "Mooooooo... talking is my favorite pastime!",
        "Moooo... wanna hear a funny moo joke?",
        "Mooooo... the sun feels great on my moo face!",
        "Moooo... I'm always moo-ving with words!",
        "Moooooo... don't stop me, I could moo all night!",
        "Moooo... did you know grass is my natural moo-tivator?",
        "Moooo... I'm moo-sically gifted, listen to my moos!",
        "Mooooooo... no one chews grass like I do!",
        "Moooo... I love sharing my moo-tastic stories!",
        "Moooooo... my moo-sings never end!",
        "Moooo... every day is a moo-racle!",
        "Mooooo... I have the fluffiest tail in town!",
        "Moooo... you can always count on me for a moo-tivation boost!",
      ];

      let currentPhraseIndex = 0;
      let selectedVoice = null;
      let voicesLoaded = false;

      // Improved voice loading with Promise
      function loadVoices() {
        return new Promise((resolve) => {
          // Check if voices are already loaded
          const voices = speechSynthesis.getVoices();
          if (voices.length > 0) {
            selectVoice(voices);
            voicesLoaded = true;
            resolve();
            return;
          }

          // Set up event listener for when voices change
          speechSynthesis.onvoiceschanged = () => {
            const voices = speechSynthesis.getVoices();
            if (voices.length > 0) {
              selectVoice(voices);
              voicesLoaded = true;
              resolve();
            }
          };

          // Fallback timeout in case voiceschanged doesn't fire
          setTimeout(() => {
            const voices = speechSynthesis.getVoices();
            if (voices.length > 0) {
              selectVoice(voices);
              voicesLoaded = true;
              resolve();
            } else {
              // If still no voices, proceed without speech
              console.warn("No voices available after timeout");
              resolve();
            }
          }, 1000);
        });
      }

      function selectVoice(voices) {
        // Try to find a suitable voice
        selectedVoice =
          voices.find(
            (v) =>
              v.name.toLowerCase().includes("zira") ||
              v.name.toLowerCase().includes("samantha") ||
              (v.name.toLowerCase().includes("google") &&
                v.lang.startsWith("en"))
          ) ||
          voices.find((v) => v.lang.startsWith("en")) ||
          voices[0];
      }

      // Initialize voices
      if (isSpeechSupported) {
        loadVoices().then(() => {
          console.log("Voices loaded:", voicesLoaded);
        });
      }

      // Main click handler
      cow.addEventListener("click", async () => {
        const phrase = mooPhrases[currentPhraseIndex];
        bubble.textContent = phrase;

        // Always play the cow sound first
        try {
          realMoo.currentTime = 0;
          await realMoo.play().catch((e) => console.warn("Audio blocked:", e));
        } catch (e) {
          console.warn("Audio playback error:", e);
        }

        // For mobile devices, we need to handle speech differently
        if (isSpeechSupported) {
          // On mobile, we need to ensure voices are loaded on each interaction
          if (!voicesLoaded) {
            await loadVoices();
          }

          // Extract text after the initial "Moooo..."
          const match = phrase.match(/(mo+[^ ]*)/i);
          const afterMoo = match
            ? phrase.slice(match.index + match[0].length).trim()
            : phrase;

          // Only speak if we have something to say and voices are loaded
          if (afterMoo && voicesLoaded && selectedVoice) {
            setTimeout(() => {
              try {
                const utterance = new SpeechSynthesisUtterance(afterMoo);
                utterance.voice = selectedVoice;
                utterance.pitch = 0.6;
                utterance.rate = 0.6;

                // Cancel any previous speech
                speechSynthesis.cancel();

                // Some devices need this wrapped in a timeout
                setTimeout(() => {
                  speechSynthesis.speak(utterance);
                }, 0);
              } catch (err) {
                console.warn("Speech synthesis failed:", err);
              }
            }, 2800); // Match cow sound duration
          }
        }

        currentPhraseIndex = (currentPhraseIndex + 1) % mooPhrases.length;
      });

      // Mobile-specific: prevent default touch behavior that might interfere
      cow.addEventListener(
        "touchstart",
        (e) => {
          e.preventDefault();
        },
        { passive: false }
      );
    </script>
  </body>
</html>
